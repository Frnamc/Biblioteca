#include <iostream>
#include <vector>
#include <string>
#include <fstream>

using namespace std;

/* ======== DECLARACIONES PERSONA 1 (LOGIN) ======== */
struct Usuario;

bool cargarUsuarios(vector<Usuario>& lista, const string& rutaArchivo);
bool validarLogin(const vector<Usuario>& lista, const string& nombre, const string& pass);

/* ======== DECLARACIONES PERSONA 2 (CRUD LIBROS) ======== */
void crearLibro();
void mostrarLibros();
void modificarLibro();
void eliminarLibro();

/* ===================== MAIN ===================== */

int main() {

    /* ===== VALIDACIÓN 1: Cargar usuarios ===== */
    vector<Usuario> usuarios;
    if (!cargarUsuarios(usuarios, "usuarios.txt")) {
        cout << "Aviso: No existe archivo de usuarios. No hay usuarios registrados.\n";
    }

    /* ===== VALIDACIÓN 2: LOGIN ===== */
    string nombre, pass;
    cout << "\n===== LOGIN =====\n";
    cout << "Usuario: ";
    cin >> nombre;
    cout << "Contrasena: ";
    cin >> pass;

    if (!validarLogin(usuarios, nombre, pass)) {
        cout << "\nAcceso denegado. Usuario o contrasena incorrectos.\n";
        return 0; // ❌ No entra al CRUD
    }

    /* ===== VALIDACIÓN 3: Acceso permitido al CRUD ===== */
    cout << "\nAcceso concedido.\n";

    int opcion;
    do {
        cout << "\n===== MENU LIBROS =====\n";
        cout << "1. Agregar libro\n";
        cout << "2. Mostrar libros\n";
        cout << "3. Modificar libro\n";
        cout << "4. Eliminar libro\n";
        cout << "5. Salir\n";
        cout << "Opcion: ";
        cin >> opcion;

        switch (opcion) {
            case 1:
                crearLibro();
                break;
            case 2:
                mostrarLibros();
                break;
            case 3:
                modificarLibro();
                break;
            case 4:
                eliminarLibro();
                break;
            case 5:
                cout << "Saliendo del sistema...\n";
                break;
            default:
                cout << "Opcion invalida.\n";
        }

    } while (opcion != 5);

    return 0;
}
